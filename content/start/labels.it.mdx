---
title: Labels e steps
description: Spiega i concetti fondamentali di label e step in Pixi'VN, spiegando nel dettaglio come il flusso narrativo è strutturato e gestito all'interno del motore.
---

import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';

Le visual novel sono solitamente costituite da una sequenza di scene con immagini e testo.

<Callout title="Nomenclature" type="info">

Il termine `label` è preso da Ren'Py, dove funge da "segnalibro" o "punto di riferimento" nella storia. Nel linguaggio ink, il termine equivalente è `knot`.

Il termine `step` è stato introdotto da Pixi'VN per rappresentare le singole azioni o eventi che si verificano all'interno di una `label`.

</Callout>

In Pixi’VN, l’intero flusso narrativo si basa sui concetti di `labels` e `steps`.

Una `label` viene utilizzata per organizzare la narrazione; funziona come un "segnalibro" o una sezione della storia. Tecnicamente, una `label` è una classe che funge da contenitore per i `label`.

Un `step` è un'azione o un evento individuale che si verifica all'interno di una `label`. I steps vengono utilizzati per visualizzare immagini, testo e altri elementi narrativi.

Il ciclo di vita di base del gioco è il seguente:

- Il gioco inizia <DynamicLink href="/start/labels-flow#run-a-label">chiamando una `label`</DynamicLink>. Il primo `step` della `label` viene eseguito automaticamente.
- After that, by connecting the <DynamicLink href="/start/labels-flow#next-step">Next Step</DynamicLink> function to an event (such as a button click), each time the function is called, the next `step` of the `label` is executed. Some `steps` can also start other `labels`.
- The game ends only when all `steps` are completed. A quel punto viene attivata la funzione <DynamicLink href="/start/other-narrative-features#how-manage-the-end-of-the-game">Game.onEnd</DynamicLink>.

## Aggiungi

To create a `label`, use the `newLabel()` function.
Questa funzione ha i seguenti parametri:

- `id`: Un identificatore univoco (stringa). Used to reference the `label` in the game (must be unique).
- `steps`: An array of functions to be executed in order, or a function that returns such an array.
- `options` (Optional): An object with the `label`'s options:
  - `onStepStart` (Optional): A function executed before each `step`. See more <DynamicLink href="/start/labels-advanced#onstepstart">here</DynamicLink>.
  - `onStepEnd` (Optional): A function executed after each `step`. See more <DynamicLink href="/start/labels-advanced#onstepend">here</DynamicLink>.
  - `onLoadingLabel` (Optional): A function executed in `onStepStart` if the `step` index is 0, or when loading a save file. See more <DynamicLink href="/start/labels-advanced#onloadinglabel">here</DynamicLink>.

```ts title="labels/startLabel.ts"
import { narration, StepLabelProps } from '@drincs/pixi-vn'

export const startLabel = newLabel("start_label",
    [
        () => {
            narration.dialogue = { character: liam, text: "Example of dialogue" }
        },
        (props: StepLabelProps, { labelId }) => narration.jumpLabel(labelId, props),
    ]
)
```

<Accordions>

<Accordion title="Overriding StepLabelProps" id="steplabelprops">

<Callout title="Templates" type="info">

In tutti i template, l'interfaccia `StepLabelProps` è già sovrascritta. La puoi trovare nel file `pixi-vn.d.ts`.

</Callout>

Tutte le <DynamicLink href="/start/labels-flow">funzioni di controllo del flusso narrativo</DynamicLink> richiedono un oggetto che corrisponda all'interfaccia `StepLabelProps`.

Per impostazione predefinita, `StepLabelProps` è `{ [key: string]: any }`. È possibile "sovrascrivere" l'interfaccia `StepLabelProps` nel file `.d.ts` per specificare i parametri richiesti.

```ts tab="pixi-vn.d.ts"
import { narration } from '@drincs/pixi-vn'

declare module '@drincs/pixi-vn' {
    interface StepLabelProps {
        navigate: (route: string) => void,
    }
}
```

```ts tab="labels/startLabel.ts"
export const startLabel = newLabel("start_label",
    [
        () => {
            return narration.callLabel(testLabel, { // [!code focus]
                navigate: (route) => { // [!code focus]
                    // navigate to route // [!code focus]
                } // [!code focus]
            }) // [!code focus]
        },
    ]
)
```

</Accordion>

<Accordion title="Step pros" id="step-pros">

You can pass a type to the `newLabel` function to add custom parameters for that `label`, in addition to [`StepLabelProps`](#steplabelprops).

```ts title="labels/startLabel.ts"
import { narration } from '@drincs/pixi-vn'

export const startLabel = newLabel<{name: string}>("start_label",
    [
        (props) => {
            console.log(props.name)
        },
    ]
)

narration.callLabel(startLabel, {
    // Add StepLabelProps here
    navigate: navigate, // example
    // And the custom props for the label
    name: "John"
})
```

</Accordion>

<Accordion title="Step results" id="step-results">

I passaggi possono restituire un oggetto `StepLabelResult`. Per impostazione predefinita, `StepLabelResult` è `{ [key: string]: any }`.

You can "override" the `StepLabelResult` interface in your `.d.ts` file to define custom properties for `step` results.

```ts tab="pixi-vn.d.ts"
declare module '@drincs/pixi-vn' {
    interface StepLabelResult {
        newRoute?: string,
        [key: string]: any
    }
}
```

```ts tab="labels/startLabel.ts"
export const startLabel = newLabel("start_label",
    [
        () => {
            return { // [!code focus]
                newRoute: '/new-route', // [!code focus]
                customProperty: 12 // [!code focus]
            } // [!code focus]
        },
    ]
)
```

</Accordion>

</Accordions>
