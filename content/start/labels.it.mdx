---
title: Labels e steps
description: Spiega i concetti fondamentali di label e step in Pixi'VN, spiegando nel dettaglio come il flusso narrativo è strutturato e gestito all'interno del motore.
---

import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';

Le visual novel sono solitamente costituite da una sequenza di scene con immagini e testo.

<Callout title="Nomenclature" type="info">
Il termine `label` è preso da Ren'Py, dove funge da "segnalibro" o "punto di riferimento" nella storia. Nel linguaggio ink, il termine equivalente è `knot`.

Il termine `step` è stato introdotto da Pixi'VN per rappresentare le singole azioni o eventi che si verificano all'interno di un'etichetta.

</Callout>

In Pixi’VN, l’intero flusso narrativo si basa sui concetti di `labels` e `steps`.

Una `label` viene utilizzata per organizzare la narrazione; funziona come un "segnalibro" o una sezione della storia. Tecnicamente, una `label` è una classe che funge da contenitore per i `label`.

Un `step` è un'azione o un evento individuale che si verifica all'interno di un'etichetta. I steps vengono utilizzati per visualizzare immagini, testo e altri elementi narrativi.

Il ciclo di vita di base del gioco è il seguente:

- Il gioco inizia <DynamicLink href="/start/labels-flow#run-a-label">chiamando una label</DynamicLink>. Il primo step della label viene eseguito automaticamente.
- After that, by connecting the <DynamicLink href="/start/labels-flow#next-step">Next Step</DynamicLink> function to an event (such as a button click), each time the function is called, the next step of the label is executed. Some steps can also start other labels.
- The game ends only when all steps are completed. At that point, the <DynamicLink href="/start/other-narrative-features#how-manage-the-end-of-the-game">Game.onEnd</DynamicLink> function is triggered.

## Adding a Label

To create a label, use the `newLabel()` function and provide:

- A unique `id` for the label.
- The `steps` of the label, as an array of functions to be executed in order, or a function that returns such an array.
- Optional `options` for the label, as an object with the following properties:
  - `onStepStart`: A function executed before each step. See more <DynamicLink href="/start/labels-advanced#onstepstart">here</DynamicLink>.
  - `onStepEnd`: A function executed after each step. See more <DynamicLink href="/start/labels-advanced#onstepend">here</DynamicLink>.
  - `onLoadingLabel`: A function executed in `onStepStart` if the step index is 0, or when loading a save file. See more <DynamicLink href="/start/labels-advanced#onloadinglabel">here</DynamicLink>.

```ts title="labels/startLabel.ts"
import { narration } from '@drincs/pixi-vn'

export const startLabel = newLabel("start_label",
    [
        () => {
            narration.dialogue = { character: liam, text: "Example of dialogue" }
        },
        (props, { labelId }) => narration.jumpLabel(labelId, props),
    ]
)
```

<Accordions>

<Accordion title="Overriding StepLabelProps" id="override-steplabelprops">

<Callout title="Templates" type="info">

In all templates, the `StepLabelProps` interface is already overridden. You can find it in the `pixi-vn.d.ts` file.

</Callout>

All <DynamicLink href="/start/labels-flow">label flow control functions</DynamicLink> require an object matching the `StepLabelProps` interface, which is passed to each step.

By default, `StepLabelProps` is `{ [key: string]: any }`. You can "override" the `StepLabelProps` interface in your `.d.ts` file to specify required parameters.

```ts tab="pixi-vn.d.ts"
import { narration } from '@drincs/pixi-vn'

declare module '@drincs/pixi-vn' {
    interface StepLabelProps {
        navigate: (route: string) => void,
    }
}
```

```ts tab="labels/startLabel.ts"
export const startLabel = newLabel("start_label",
    [
        () => {
            return narration.callLabel(testLabel, { // [!code focus]
                navigate: (route) => { // [!code focus]
                    // navigate to route // [!code focus]
                } // [!code focus]
            }) // [!code focus]
        },
    ]
)
```

</Accordion>

<Accordion title="Step pros" id="step-pros">

You can pass a type to the `newLabel` function to add custom parameters for that label, in addition to [`StepLabelProps`](#overriding-steplabelprops).

```ts title="labels/startLabel.ts"
import { narration } from '@drincs/pixi-vn'

export const startLabel = newLabel<{name: string}>("start_label",
    [
        (props) => {
            console.log(props.name)
        },
    ]
)

narration.callLabel(startLabel, {
    // Add StepLabelProps here
    navigate: navigate, // example
    // And the custom props for the label
    name: "John"
})
```

</Accordion>

<Accordion title="Step results" id="step-results">

Steps can return a `StepLabelResult` object. By default, `StepLabelResult` is `{ [key: string]: any }`.

You can "override" the `StepLabelResult` interface in your `.d.ts` file to define custom properties for step results.

```ts tab="pixi-vn.d.ts"
declare module '@drincs/pixi-vn' {
    interface StepLabelResult {
        newRoute?: string,
        [key: string]: any
    }
}
```

```ts tab="labels/startLabel.ts"
export const startLabel = newLabel("start_label",
    [
        () => {
            return { // [!code focus]
                newRoute: '/new-route', // [!code focus]
                customProperty: 12 // [!code focus]
            } // [!code focus]
        },
    ]
)
```

</Accordion>

</Accordions>

## Step Save Limit

At each step, all information about the current game state is <DynamicLink href="/start/save">saved</DynamicLink>.

To prevent the save file from growing too large, there is a limit on the number of steps saved. By default, only the last 20 steps are saved, but you can increase this limit (e.g., to 100). When the limit is reached, only essential information from older steps is kept. This allows you to display the full <DynamicLink href="/start/history">narrative history</DynamicLink>, but you cannot <DynamicLink href="/start/labels-flow#go-back">return</DynamicLink> to a specific step beyond the limit.

You can change the step save limit by setting the `stepLimitSaved` property in the `stepHistory` object.

```typescript
import { stepHistory } from '@drincs/pixi-vn'

stepHistory.stepLimitSaved = 100
```

To disable the step save limit, set `stepLimitSaved` to `Infinity`.

```typescript
import { stepHistory } from '@drincs/pixi-vn'

stepHistory.stepLimitSaved = Infinity
```
