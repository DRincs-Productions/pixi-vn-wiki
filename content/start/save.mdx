---
title: Save and load
---

The save and load system is a feature that allows the player to save the game progress and load it later. This feature is essential for visual novels, as it allows the player to continue the story from where they left off.

## Create

To create a save, you can use the `Game.exportGameState` function. This function returns an object with the game data, which you can then save to a file or a database.

My advice is to insert the generated file in question with other information created by the user, such as the name of the save, the date of creation, and an image of the current game state.

<Callout type="info">

For generate the image, you can use the `canvas.extractImage()` function, which returns a base64 string of the current game state. You can then use this string to create an image file.

</Callout>

For example:

```ts tab="utils/save-utility.ts"
import { Game } from "@drincs/pixi-vn";
import GameSaveData from "../models/GameSaveData";

export function createGameSave(options?: { image?: string; name?: string }): GameSaveData {
    const { image, name = "" } = options || {};
    return {
        saveData: Game.exportGameState(),
        gameVersion: __APP_VERSION__,
        date: new Date(),
        name: name,
        image: image,
    };
}
```

```ts tab="models/GameSaveData.ts"
import { GameState } from "@drincs/pixi-vn";

export default interface GameSaveData {
    saveData: GameState;
    gameVersion: string;
    date: Date;
    name: string;
    image?: string;
}
```

## Load

To load the game progress, you can use the `Game.restoreGameState` function. This function receives a object with the game data and a function `navigate: (path: string) => void` that will be called with the <DynamicLink href="/start/start/interface-navigate">URL Path or Route</DynamicLink> of the saved `step`, so you can use it to navigate to the saved <DynamicLink href="/start/interface-navigate">UI screen</DynamicLink>.

If you want to load the game progress from a json string, you can use the `Game.restoreGameState` function.

A exemple of how to load the game progress:

```typescript
export function loadGameSave(navigate: (path: string) => void, afterLoad?: () => void) {
    // load the save data from a JSON file
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'application/json';
    input.onchange = (e) => {
        const file = (e.target as HTMLInputElement).files?.[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const jsonString = e.target?.result as string;
                // load the save data from the JSON string
                Game.restoreGameState(jsonString, navigate).then(() => {
                    afterLoad && afterLoad();
                });
            };
            reader.readAsText(file);
        }
    };
    input.click();
}
```

## Convert JSON to Save Data

If you want to convert a JSON string to a save data object, you can use the `Game.jsonToGameState` function.

A exemple of how to convert a JSON string to a save data object:

```typescript
const saveData = Game.jsonToGameState(jsonString);
```

## Get Pixi’VN version of the save data

Pixi’VN add your own version in the save data object. You can access it by the `version` property.

```typescript
const saveData = Game.jsonToGameState(jsonString);
console.log(saveData.version);
```

<Comments>
TODO IndexedDB option
</Comments>
