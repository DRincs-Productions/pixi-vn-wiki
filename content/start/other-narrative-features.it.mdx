---
title: Altre caratteristiche narrative
description: Copre ulteriori funzionalità narrative di Pixi'VN, tra cui la gestione della fine del gioco, la gestione degli errori e la generazione di numeri casuali.
---

import { Accordion, Accordions } from 'fumadocs-ui/components/accordion';

<Accordions>

<Accordion title="Managing the end of the game" id="managing-the-end-of-the-game">

Quando tutti i `passaggi` di tutte le `etichette` saranno stati eseguiti, il gioco si fermerà. Lo sviluppatore è responsabile della gestione del finale del gioco, poiché le visual novel possono avere diverse strategie di conclusione:

- Il gioco termina quando tutti gli `steps` sono stati eseguiti.
- The game has no end; if all steps are completed, another `label` will be started or the player will have to interact with an interface that can potentially start another `label`.
- The game ends when the player reaches a specific point, such as due to game over.

Per gestire la fine della partita, impostare `Game.onEnd`. Questa funzione viene chiamata al termine del gioco e ha la stessa firma di un `step`.

Ad esempio, per terminare il gioco e passare alla schermata finale:

```ts title="main.ts"
import { Game } from '@drincs/pixi-vn'

Game.onEnd(async (props) => {
    props.navigate("/end")
})
```

Se il gioco non ha fine e deve riavviarsi o andare in loop:

```ts title="labels/startLabel.ts"
export const startLabel = newLabel("start_label_id",
    () => {
        return [
            // ...
        ]
    }
)
```

```ts title="main.ts"
import { Game } from '@drincs/pixi-vn'

Game.onEnd(async (props) => {
    narration.call(startLabel, props)
})
```

</Accordion>

<Accordion title="Handling step errors" id="handling-step-errors">

Se si verifica un errore in un `passaggio`, il gioco registra un errore sulla console e interrompe l'esecuzione dei passaggi successivi. Lo sviluppatore dovrebbe gestire gli errori impostando `Game.onError`.

Ad esempio, per inviare una notifica quando si verifica un errore:

```ts title="main.ts"
import { Game } from '@drincs/pixi-vn'

Game.onError((type, error, { notify }) => {
    notify("An error occurred")
    // Optionally send the error to GlitchTip, Sentry, etc.
})
```

</Accordion>

<Accordion title="Random number generation" id="random-number-generation">

Pixi’VN include una funzione integrata per generare numeri casuali. Utilizza `narration.getRandomNumber()` con i seguenti parametri:

- `min`: Il valore minimo.
- `max`: Il valore massimo.
- `options` (Opzionale):
  - `onceonly`: Se `true`, il numero verrà generato una sola volta per lo `step` corrente della `label` (predefinito: `false`). Nota: `min` e `max` influenzano la memorizzazione dei numeri già generati.

</Accordion>

<Accordion title="Check if the label has already been completed" id="check-if-the-label-has-already-been-completed">

Per verificare se un'etichetta è già stata completata, utilizzare la funzione `narration.isLabelAlreadyCompleted`.
Questa funzione ha i seguenti parametri:

- `label`: The <DynamicLink href="/start/labels">`label`</DynamicLink> to check.

```typescript
const isLabelCompleted = narration.isLabelAlreadyCompleted(startLabel)
const isLabelCompleted = narration.isLabelAlreadyCompleted("labelid")
```

</Accordion>

<Accordion title="Check if current step has already been opened" id="check-if-current-step-is-already-been-opened">

Per verificare se lo `step` corrente è già stato aperto, utilizzare `narration.isCurrentStepAlreadyOpened`.

```typescript
const isCurrentStepOpened = narration.isCurrentStepAlreadyOpened;
```

</Accordion>

<Accordion title="Counter of execution times of the current step" id="counter-of-execution-times-of-the-current-step">

Per ottenere il conteggio delle esecuzioni per lo `step` corrente, utilizzare `narration.currentStepTimesCounter`. **Important:** The counter is only incremented if `narration.currentStepTimesCounter` is executed.

```ts title="labels/startLabel.ts"
export const label = newLabel("id",
    () => {
        if (narration.currentStepTimesCounter === 0) { // ✅ will be incremented
            // ...
        } else {
            // ...
        }
    }
)
```

```ts title="labels/startLabel.ts"
export const label = newLabel("id",
    () => {
        if (narration.currentStepTimesCounter === 0) { // ✅ will be incremented
            // ...
        } else if (narration.currentStepTimesCounter === 1) { // ✅ Not incremented again in this step
            // ...
        }
    }
)
```

```ts title="labels/startLabel.ts"
export const label = newLabel("id",
    () => {
        if (flag) {
            if (narration.currentStepTimesCounter === 1) { // ❌ Only incremented if "flag" is true
                // ...
            }
        }
    }
)
```

Per reimpostare il contatore di esecuzione per il `step` corrente, impostare `narration.currentStepTimesCounter = 0`.

```typescript
narration.currentStepTimesCounter = 0;
```

</Accordion>

</Accordions>
