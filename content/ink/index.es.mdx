---
title: Integración del lenguaje ink
description: Crea narrativas interactivas usando ink, un lenguaje de scripting diseñado para historias ramificadas, integrado con Pixi’VN.
---

import { InkExample } from "@/components/ink-examples";

Pixi’VN te permite escribir narrativas interactivas utilizando **_ink_**, un lenguaje de scripting diseñado para historias ramificadas.

**¿Qué es _ink_?** **_ink_** es un lenguaje de scripting sencillo para historias interactivas, utilizado en juegos como 80 Days, Heaven's Vault y Sorcery! Puedes obtener más información en el [sitio web oficial de _ink_](https://www.inklestudios.com/ink/).

**La integración _ink_ + Pixi’VN** utiliza [inkjs](https://github.com/inkle/inkjs) y <DynamicLink href="/json">PixiVNJson</DynamicLink> para analizar el **código \***ink**\* ** y generar JSON que Pixi’VN puede interpretar. Esto significa que JavaScript/TypeScript y **_ink_** comparten el mismo almacenamiento y canvas, y puedes ejecutar `knots` (o `labels`) de **_ink_** desde JavaScript/TypeScript y viceversa. Obtienes lo mejor de ambos mundos: escribir la narración en **_ink_** y usar JavaScript/TypeScript para minijuegos o animaciones avanzadas.

```ink title="ink/start.ink"
=== start ===
We arrived into London at 9.45pm exactly.

* "There is not a moment to lose!"[] I declared.
 -> hurry_outside

* "Monsieur, let us savour this moment!"[] I declared.
 My master clouted me firmly around the head and dragged me out of the door.
 -> dragged_outside

* [We hurried home] -> hurry_outside

=== hurry_outside ===
We hurried home to Savile Row -> as_fast_as_we_could

=== dragged_outside ===
He insisted that we hurried home to Savile Row
-> as_fast_as_we_could

=== as_fast_as_we_could ===
<> as fast as we could.
-> start
```

<InkExample />

## Why?

Escribir la narrativa directamente en **JavaScript/TypeScript** puede ser lento y complejo, especialmente para principiantes. **_ink_** es mucho más fácil de aprender y escribir.

Los nuevos desarrolladores pueden empezar con una <DynamicLink href="/start#project-initialization">plantilla de _ink_</DynamicLink> y luego aprender gradualmente JavaScript/TypeScript para funciones avanzadas.

## Instalación

<Callout title="Templates" type="info">

¿Empiezas un nuevo proyecto Pixi’VN? Usa una <DynamicLink href="/start#project-initialization">plantilla</DynamicLink> que ya incluya _ink_.

</Callout>

Para instalar el paquete _ink_ en un proyecto JavaScript existente, utiliza uno de los siguientes comandos:

```sh tab="npm"
npm install @drincs/pixi-vn @drincs/pixi-vn-ink
```

```sh tab="yarn"
yarn add @drincs/pixi-vn @drincs/pixi-vn-ink
```

```sh tab="pnpm"
pnpm add @drincs/pixi-vn @drincs/pixi-vn-ink
```

```sh tab="bun"
bun add @drincs/pixi-vn @drincs/pixi-vn-ink
```

```sh tab="deno"
deno install npm:@drincs/pixi-vn npm:@drincs/pixi-vn-ink
```

### Inicialización

Después de la instalación, utiliza `importInkText()` para cargar tu **script \***ink**\* **:

```typescript title="main.ts"
import { importInkText } from '@drincs/pixi-vn-ink'

const inkText = `
=== start ===
Hello
-> END
`

importInkText([inkText, ...])
```

A continuación, puedes ejecutar un **_ink_ `knot`** (o `label`) usando las <DynamicLink href="/start/labels#run-a-label">funciones de Pixi’VN</DynamicLink>:

```typescript title="main.ts"
import { narration } from '@drincs/pixi-vn'

narration.call(`start`, {})
```

<Accordions>

<Accordion title="import_ink_files" id="import-ink-files">

<Callout type="info">

Esta guía utiliza [Vite](https://vitejs.dev/), pero la misma lógica se aplica en otros entornos.

</Callout>

Para importar archivos `.ink`, debes configurar tu proyecto para tratarlos como archivos de texto.

Los pasos son los siguientes:

- Declarar el módulo `*.ink` en `ink.d.ts`.
- Añadir `.ink` a `assetsInclude` en `vite.config.ts`.
- Importar el archivo con `?raw` para obtener su contenido de texto.

```ts tab="main.ts"
import { importInkText } from '@drincs/pixi-vn-ink'
import startLabel from './ink/start.ink?raw'

importInkText([startLabel, ...])
```

```ts tab="vite.config.ts"
export default defineConfig({
  // ...
  assetsInclude: ['**/*.ink'],
})
```

```ts tab="ink.d.ts"
declare module '*.ink' {
    const value: string
    export default value
}
```

</Accordion>

<Accordion title="import_ink_folder" id="import-ink-folder">

<Callout type="info">

Esta guía utiliza [Vite](https://vitejs.dev/), pero la misma lógica se aplica en otros entornos.

</Callout>

Para importar varios archivos `.ink`, utiliza `import.meta.glob`:

```ts tab="utils/ink-utility.ts"
import { convertInkText, importInkText } from "@drincs/pixi-vn-ink";

async function getInkText() {
    const files = import.meta.glob<string>("../ink/*.ink", { query: "?raw", import: "default" });
    return await Promise.all(
        Object.values(files).map(async (importFile) => {
            return await importFile();
        })
    );
}

export async function importAllInkLabels() {
    let fileEntries = await getInkText();
    await importInkText(fileEntries);
}

export async function convertInkToJson() {
    let fileEntries = await getInkText();
    return await Promise.all(fileEntries.map((data) => convertInkText(data)));
}
```

```ts tab="vite.config.ts"
export default defineConfig({
  // ...
  assetsInclude: ['**/*.ink'],
})
```

</Accordion>

<Accordion title="vite_js_plugin" id="vite-plugin">

Para una mejor experiencia de desarrollo, utiliza el plugin de Vite:

```ts tab="vite.config.ts"
import { defineConfig } from 'vite'
import { vitePluginInk } from '@drincs/pixi-vn-ink/vite'
export default defineConfig({
  // ...
  plugins: [
    // other plugins...
    vitePluginInk()
  ]
})
```

```ts tab="main.ts"
import { setupInkHmrListener } from '@drincs/pixi-vn-ink/vite-listener'

setupInkHmrListener()
```

```ts tab="utils/ink-utility.ts"
async function getInkText() {
    const files = import.meta.glob<string>("../ink/*.ink", { eager: true, import: "default" });
    return await Promise.all(
        Object.values(files).map(async (importFile) => {
            return importFile;
        })
    );
}
```

</Accordion>

</Accordions>

## Próximas funciones

Estas funciones están en desarrollo.

<Callout type="info">

Muestra tu interés dando “me gusta” o comentando en los issues.

</Callout>

- [Functions and Game Queries](https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md#9-game-queries-and-functions) ([#11](https://github.com/DRincs-Productions/pixi-vn-ink/issues/11)):
  - [User-created functions](https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md#5-functions) ([#32](https://github.com/DRincs-Productions/pixi-vn-ink/issues/32))
  - `CHOICE_COUNT()`
  - `TURNS()`
  - `TURNS_SINCE()`
  - `SEED_RANDOM()`
- [`LIST`](https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md#1-basic-lists) ([#15](https://github.com/DRincs-Productions/pixi-vn-ink/issues/15))
- [`Tunnels`](https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md#1-tunnels) ([#38](https://github.com/DRincs-Productions/pixi-vn-ink/issues/38))

## Sintaxis de _ink_ ignorada por Pixi’VN

Parte de la sintaxis de _ink_ es ignorada por Pixi’VN. Puedes usarla en tu **script \***ink**\* ** (por ejemplo, para pruebas en el editor Inky), pero Pixi’VN la ignorará.

### INCLUDE

`INCLUDE` es una instrucción de _ink_ para incluir otro archivo _ink_. En Pixi’VN debes usar `importInkText()` para cargar varios archivos _ink_, por lo que `INCLUDE` se ignora.

### Narración fuera de los `knots`

La narración fuera de los `knots` (o `labels`) se ignora, excepto las variables.

For example:

```ink title="ink"
VAR my_var = false // ✅ This will be handled (because it is a variable)
Hello // ❌ This will be ignored  [!code warning]
-> start // ❌ This will be ignored [!code warning]
=== start === // ✅ This will be handled
My name is John // ✅ This will be handled
-> DONE // ✅ This will be handled
```

## Diferencias entre _ink_ nativo y _ink_ de Pixi’VN

- en este caso:

  ```ink title="ink"
  { shuffle:
    -  2 of Diamonds.
      'You lose this time!' crowed the croupier.
  }
  ```

    **En _ink_ nativo**, verás dos diálogos diferentes: el primero será `2 of Diamonds.` y el segundo será `'You lose this time!' crowed the croupier.`.

    En **Pixi’VN _ink_**, no verás dos diálogos distintos, sino el siguiente diálogo: `2 of Diamonds.\n\n'You lose this time!' crowed the croupier.`. En <DynamicLink href="/ink/markup#markdown-on-ink">Markdown</DynamicLink> se mostrará en varias líneas:

  ```txt
  2 of Diamonds.
  'You lose this time!' crowed the croupier.
  ```

- si un `weave` (en el siguiente ejemplo `shove`) está asociado a un one time choice y se abre con `-> shove`, ese one time choice no se invalidará. Para invalidarlo, es necesario seleccionar la opción de la forma habitual.

    A continuación se muestra un ejemplo:

  ```ink title="ink"
  -> start
  === start ===
  * [1] -> shove
  * (shove) [2] 2
  * {shove} [3] -> END
  -  -> start
  -> DONE
  ```

    Si eliges la opción `1`, cuando `start` se abra por segunda vez, el comportamiento será el siguiente:

  - si usas **native _ink_**, solo podrás elegir la opción `3`. La opción `2` estará oculta porque, al ser un one time choice, **native _ink_** sabe que ya has tomado esta decisión mediante `-> shove`.
  - si usas **Pixi’VN _ink_**, podrás elegir la opción `2` o `3`. La opción `2` no está oculta porque **Pixi’VN _ink_** no sabe que `shove` está vinculado a una elección.

  Para obtener la misma lógica en `start` tanto en **native _ink_** como en **Pixi’VN _ink_**, debes escribir el siguiente código:

  ```ink title="ink"
  -> start
  === start ===
  * [1] -> shove
  * (shove) {!shove} [2] 2
  * {shove} [3] -> END
  -  -> start
  -> DONE
  ```
