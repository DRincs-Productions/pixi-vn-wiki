---
title: Intégration du langage ink
description: Write interactive narratives using ink, a scripting language designed for branching stories, integrated with Pixi’VN.
---

import { InkExample } from "@/components/ink-examples";

Pixi’VN vous permet d’écrire des récits interactifs en utilisant **_ink_**, un langage de script conçu pour les histoires à embranchements.

**Qu’est-ce que _ink_ ?** **_ink_** est un langage de script simple pour les histoires interactives, utilisé dans des jeux comme 80 Days, Heaven's Vault et Sorcery! Pour en savoir plus, consultez le [site officiel de _ink_](https://www.inklestudios.com/ink/).

**L’intégration _ink_ + Pixi’VN** utilise [inkjs](https://github.com/inkle/inkjs) et <DynamicLink href="/json">PixiVNJson</DynamicLink> pour analyser le **code \***ink**\* ** et générer du JSON que Pixi’VN peut interpréter. Cela signifie que JavaScript/TypeScript et **_ink_** partagent le même stockage et canvas, et vous pouvez lancer des `knots` (ou `labels`) de **_ink_** depuis JavaScript/TypeScript et vice versa. Vous profitez ainsi du meilleur des deux mondes : écrire la narration en **_ink_** et utiliser JavaScript/TypeScript pour des mini-jeux ou des animations avancées.

```ink title="ink/start.ink"
=== start ===
We arrived into London at 9.45pm exactly.

* "There is not a moment to lose!"[] I declared.
 -> hurry_outside

* "Monsieur, let us savour this moment!"[] I declared.
 My master clouted me firmly around the head and dragged me out of the door.
 -> dragged_outside

* [We hurried home] -> hurry_outside

=== hurry_outside ===
We hurried home to Savile Row -> as_fast_as_we_could

=== dragged_outside ===
He insisted that we hurried home to Savile Row
-> as_fast_as_we_could

=== as_fast_as_we_could ===
<> as fast as we could.
-> start
```

<InkExample />

## Why?

Écrire la narration directement en **JavaScript/TypeScript** peut être lent et complexe, surtout pour les débutants. **_ink_** est beaucoup plus facile à apprendre et à utiliser.

Les nouveaux développeurs peuvent commencer avec un <DynamicLink href="/start#project-initialization">modèle _ink_</DynamicLink>, puis apprendre progressivement JavaScript/TypeScript pour des fonctionnalités avancées.

## Installation

<Callout title="Templates" type="info">

Vous commencez un nouveau projet Pixi’VN ? Utilisez un <DynamicLink href="/start#project-initialization">modèle</DynamicLink> qui inclut déjà _ink_.

</Callout>

Pour installer le paquet _ink_ dans un projet JavaScript existant, utilisez l’une des commandes suivantes:

```sh tab="npm"
npm install @drincs/pixi-vn @drincs/pixi-vn-ink
```

```sh tab="yarn"
yarn add @drincs/pixi-vn @drincs/pixi-vn-ink
```

```sh tab="pnpm"
pnpm add @drincs/pixi-vn @drincs/pixi-vn-ink
```

```sh tab="bun"
bun add @drincs/pixi-vn @drincs/pixi-vn-ink
```

```sh tab="deno"
deno install npm:@drincs/pixi-vn npm:@drincs/pixi-vn-ink
```

### Initialisation

Après l’installation, utilisez `importInkText()` pour charger votre **script \***ink**\* **:

```typescript title="main.ts"
import { importInkText } from '@drincs/pixi-vn-ink'

const inkText = `
=== start ===
Hello
-> END
`

importInkText([inkText, ...])
```

Vous pouvez ensuite exécuter un `knot` (ou `label`) de **_ink_** avec les <DynamicLink href="/start/labels#run-a-label">fonctions Pixi’VN</DynamicLink>:

```typescript title="main.ts"
import { narration } from '@drincs/pixi-vn'

narration.call(`start`, {})
```

<Accordions>

<Accordion title="import_ink_files" id="import-ink-files">

<Callout type="info">

Ce guide utilise [Vite](https://vitejs.dev/), mais la même logique s’applique ailleurs.

</Callout>

Pour importer des fichiers `.ink`, vous devez configurer votre projet pour les traiter comme des fichiers texte.

Les étapes sont les suivantes :

- Déclarer le module `*.ink` dans `ink.d.ts`.
- Ajouter `.ink` à `assetsInclude` dans `vite.config.ts`.
- Importer le fichier avec `?raw` pour obtenir son contenu texte.

```ts tab="main.ts"
import { importInkText } from '@drincs/pixi-vn-ink'
import startLabel from './ink/start.ink?raw'

importInkText([startLabel, ...])
```

```ts tab="vite.config.ts"
export default defineConfig({
  // ...
  assetsInclude: ['**/*.ink'],
})
```

```ts tab="ink.d.ts"
declare module '*.ink' {
    const value: string
    export default value
}
```

</Accordion>

<Accordion title="import_ink_folder" id="import-ink-folder">

<Callout type="info">

Ce guide utilise [Vite](https://vitejs.dev/), mais la même logique s’applique ailleurs.

</Callout>

Pour importer plusieurs fichiers `.ink`, utilisez `import.meta.glob`:

```ts tab="utils/ink-utility.ts"
import { convertInkText, importInkText } from "@drincs/pixi-vn-ink";

async function getInkText() {
    const files = import.meta.glob<string>("../ink/*.ink", { query: "?raw", import: "default" });
    return await Promise.all(
        Object.values(files).map(async (importFile) => {
            return await importFile();
        })
    );
}

export async function importAllInkLabels() {
    let fileEntries = await getInkText();
    await importInkText(fileEntries);
}

export async function convertInkToJson() {
    let fileEntries = await getInkText();
    return await Promise.all(fileEntries.map((data) => convertInkText(data)));
}
```

```ts tab="vite.config.ts"
export default defineConfig({
  // ...
  assetsInclude: ['**/*.ink'],
})
```

</Accordion>

<Accordion title="vite_js_plugin" id="vite-plugin">

Pour une meilleure expérience de développement, utilisez le plugin Vite:

```ts tab="vite.config.ts"
import { defineConfig } from 'vite'
import { vitePluginInk } from '@drincs/pixi-vn-ink/vite'
export default defineConfig({
  // ...
  plugins: [
    // other plugins...
    vitePluginInk()
  ]
})
```

```ts tab="main.ts"
import { setupInkHmrListener } from '@drincs/pixi-vn-ink/vite-listener'

setupInkHmrListener()
```

```ts tab="utils/ink-utility.ts"
async function getInkText() {
    const files = import.meta.glob<string>("../ink/*.ink", { eager: true, import: "default" });
    return await Promise.all(
        Object.values(files).map(async (importFile) => {
            return importFile;
        })
    );
}
```

</Accordion>

</Accordions>

## Fonctionnalités à venir

Ces fonctionnalités sont en cours de développement.

<Callout type="info">

Montrez votre intérêt en aimant ou commentant les issues.

</Callout>

- [Functions and Game Queries](https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md#9-game-queries-and-functions) ([#11](https://github.com/DRincs-Productions/pixi-vn-ink/issues/11)):
  - [User-created functions](https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md#5-functions) ([#32](https://github.com/DRincs-Productions/pixi-vn-ink/issues/32))
  - `CHOICE_COUNT()`
  - `TURNS()`
  - `TURNS_SINCE()`
  - `SEED_RANDOM()`
- [`LIST`](https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md#1-basic-lists) ([#15](https://github.com/DRincs-Productions/pixi-vn-ink/issues/15))
- [`Tunnels`](https://github.com/inkle/ink/blob/master/Documentation/WritingWithInk.md#1-tunnels) ([#38](https://github.com/DRincs-Productions/pixi-vn-ink/issues/38))

## Syntaxe _ink_ ignorée par Pixi’VN

Certaines syntaxes de _ink_ sont ignorées par Pixi’VN. Vous pouvez les utiliser dans votre **script \***ink**\* ** (par exemple pour tester dans l’éditeur Inky), mais Pixi’VN ne les traitera pas.

### INCLUDE

`INCLUDE` est une instruction _ink_ pour inclure un autre fichier _ink_. Dans Pixi’VN, vous devez utiliser `importInkText()` pour charger plusieurs fichiers _ink_, donc `INCLUDE` est ignoré.

### Narration en dehors des `knots`

La narration en dehors des `knots` (ou `labels`) est ignorée, sauf pour les variables.

For example:

```ink title="ink"
VAR my_var = false // ✅ This will be handled (because it is a variable)
Hello // ❌ This will be ignored  [!code warning]
-> start // ❌ This will be ignored [!code warning]
=== start === // ✅ This will be handled
My name is John // ✅ This will be handled
-> DONE // ✅ This will be handled
```

## Différences entre _ink_ natif et _ink_ Pixi’VN

- dans ce cas:

  ```ink title="ink"
  { shuffle:
    -  2 of Diamonds.
      'You lose this time!' crowed the croupier.
  }
  ```

    **Dans l’_ink_ natif**, vous verrez deux dialogues distincts : le premier sera `2 of Diamonds.` et le second sera `'You lose this time!' crowed the croupier.`.

    Dans **Pixi’VN _ink_**, vous ne verrez pas deux dialogues distincts, mais le dialogue suivant : `2 of Diamonds.\n\n'You lose this time!' crowed the croupier.`. En <DynamicLink href="/ink/markup#markdown-on-ink">Markdown</DynamicLink>, il sera affiché sur plusieurs lignes:

  ```txt
  2 of Diamonds.
  'You lose this time!' crowed the croupier.
  ```

- si un `weave` (dans l’exemple suivant `shove`) est attaché à un one time choice et qu’il est ouvert avec `-> shove`, ce one time choice ne sera pas invalidé. Pour l’invalider, il faut sélectionner le choix de manière classique.

    Voici un exemple:

  ```ink title="ink"
  -> start
  === start ===
  * [1] -> shove
  * (shove) [2] 2
  * {shove} [3] -> END
  -  -> start
  -> DONE
  ```

    Si vous choisissez l’option `1`, lors de la seconde ouverture de `start`, le comportement sera le suivant :

  - en utilisant **native _ink_**, vous ne pourrez choisir que l’option `3`. L’option `2` est masquée, car étant un one time choice, **native _ink_** sait que cette décision a déjà été prise via `-> shove`.
  - en utilisant **Pixi’VN _ink_**, vous pourrez choisir l’option `2` ou `3`. L’option `2` n’est pas masquée, car **Pixi’VN _ink_** ne sait pas que `shove` est associé à un choix.

  Pour obtenir la même logique pour `start` à la fois dans **native _ink_** et **Pixi’VN _ink_**, vous devez écrire le code suivant:

  ```ink title="ink"
  -> start
  === start ===
  * [1] -> shove
  * (shove) {!shove} [2] 2
  * {shove} [3] -> END
  -  -> start
  -> DONE
  ```
