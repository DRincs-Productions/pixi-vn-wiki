---
title: Как перевести визуальную новеллу?
---

В визуальных новеллах и других типах игр обычно есть возможность выбрать язык игры.

В проекте Pixi’VN вам необходимо использовать внешние библиотеки для работы с переводами. Поэтому вы можете выбрать ту реализацию, которая вам больше подходит.

Наиболее используемой библиотекой, совместимой со многими фреймворками, является i18next.

![i18next-h2](/i18next.svg)

## Что такое i18next?

i18next - это фреймворк интернационализации, написанный на JavaScript и для него. Для того чтобы использовать i18n, необходимо установить и инициализировать его.

Подробнее о i18next можно узнать на сайте [i18next](https://www.i18next.com/).

Переводы будут вставлены в несколько json-файлов (по одному json-файлу для каждого языка) с соответствующим значением ключа. Где ключ - это уникальный ключ текста (или текста для перевода), а значение - это текст, который будет отображаться. Рекомендуется разделить переводы на две части (см. файл `strings_es.json`):

- Тексты [UI](/start/interface), то есть тексты, которые содержатся в экранах, настройках, быстрых кнопках и т. д... то есть всё, что не является частью повествования.
- Тексты [повествования](/start/narration), т.е. тексты, содержащиеся в диалогах, в меню выбора и т. д...

```ts tab="i18n.ts"
import i18n from 'i18next';
import LanguageDetector from 'i18next-browser-languagedetector';
import { initReactI18next } from 'react-i18next';
import strings_en from '../src/values/translations/strings_en.json';
import strings_es from '../src/values/translations/strings_es.json';

const getUserLang = (): string => {
    let userLang: string = navigator.language || "en";
    return userLang?.toLocaleLowerCase()?.split("-")[0];
}

export const useI18n = () => {
    if (!i18n.isInitialized) {
        i18n
            .use(LanguageDetector)
            .use(initReactI18next)
            .init({
                debug: false,
                fallbackLng: 'en',
                lng: getUserLang(),
                interpolation: {
                    escapeValue: false,
                },
                resources: {
                    en: strings_en,
                    es: strings_es,
                    // Добавьте больше языков здесь
                }
            });
    }
}
```

```ts tab="main.ts"
import { useI18n } from './i18n';

useI18n()
```

```json tab="locales/strings_es.json"
{
    "ui": {
        "text_speed": "Velocidad del texto",
        // ...
    },
    "narration": {
        "Привет, меня зовут {{name}}": "Hola, mi nombre es {{name}}"
        // ...
    }
}
```

В зависимости от того, что вы хотите перевести, рекомендуется использовать следующие руководства:

- [Пользовательский интерфейс](#translate-the-ui)
- [Повествование (TypeScript/JavaScript)](#translate-the-narration-typescriptjavascript)
- [Повествование (_ink_)](/ink/ink-translate)
- Повествование (Ren'Py) (в разработке)

## Переведите пользовательский интерфейс

Чтобы перевести UI, необходимо использовать функцию `t`, предоставляемую i18next. Функция `t` - это функция, которая будет вызываться при передаче клавиши в качестве входного сигнала для получения соответствующего текста на языке игрока.

For example:

```tsx tab="React"
import { useTranslation } from 'react-i18next';

export default function MyComponent() {
    const { t } = useTranslation("ui");

    return (
        <div>
            <Button>{t("text_speed")}</Button>
        </div>
    );
}
```

```vue tab="Vue"
<script setup>
    import { useTranslation } from "i18next-vue";
    const { t } = useTranslation("ui");
</script>

<template>
    <div>
        <button>{{ t('text_speed') }}</button>
    </div>
</template>
```

```svelte tab="Svelte"
<script>
    import { useTranslation } from 'svelte-i18n';
    const { t } = useTranslation("ui");
</script>

<div>
    <button>{t('text_speed')}</button>
</div>
```

## Перевод повествования (TypeScript/JavaScript)

Чтобы перевести UI, вам нужно "переопределить" интерфейс `StepLabelProps` в файле `.d.ts`, чтобы добавить функцию `t`. Функция `t` - это функция, которая будет вызываться при передаче клавиши в качестве входного сигнала для получения соответствующего текста на языке игрока.

Таким образом, вы можете использовать функцию `t` в [labels](/start/labels.md) для перевода текста. Рекомендуется использовать `t` внутри [label](/start/labels), а не при отображении UI, так как в этом случае вы сможете использовать [i18n Interpolation](https://i18next.com/translation-function/interpolation).

В качестве ключа перевода рекомендуется использовать родную строку, с которой выполняется перевод.

```ts tab="pixi-vn.d.ts"
declare module '@drincs/pixi-vn' {
    interface StepLabelProps {
        /**
         * Перевести ключ в строку.
         * @param key Ключ, который надо перевести
         * @returns Переведённая строка
         */
        t: TFunction<[string], undefined>
        // ...
    }
}
```

```ts tab="labels/startLabel.ts"
export const startLabel = newLabel("start_label",
    [
        ({ t }) => { // [!code focus]
            narration.dialogue = {
                character: liam,
                text: t("Hello, my name is {{name}}", { name: "Liam" }) // [!code focus]
            }
        },
    ]
)
```
